<!DOCTYPE html>

<html layout:decorator="main/layout">
  <head>
    <title>Avatar - WebChat</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 

  </head>
  <body>

    <div class="col s9 grey lighten-4" layout:fragment="content" >
        
        <h4>Chat test</h4>
        
            <div id="conversationDiv">
                <input type="text" id="inputText" placeholder="Write a message..."/>
                <button id="sendMessage">Send</button>
              
            </div>
            
            <ul id="myList">
            
           
            </ul>
            
    </div>
        
    <th:block layout:fragment="script">

    <script type="text/javascript">
      
      var ws;
        
        $(document).ready(function(){
             document.querySelector('#sendMessage').addEventListener('click', sendMessage);
            ws = new WebSocket('ws://localhost:8080/WebChat/chat');
            
            
            ws.onmessage = function(data) {
            var node = document.createElement("LI");
            var textnode = document.createTextNode(data.data);
            node.appendChild(textnode);
            document.getElementById("myList").appendChild(node);
            };
                
        });
        
             function sendMessage(){
                var message = document.getElementById("inputText").value;
              
             
       
                ws.send("[[${username}]]" +  ':'  + message);
            }
           
    </script>
  </th:block>
  </body>
</html>
